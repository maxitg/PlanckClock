<html>
<head>
<title>Planck Clock</title>
<script type="text/javascript" src="MathContext.js"></script>
<script type="text/javascript" src="BigDecimal.js"></script> 
<script type="text/javascript" src="javascript-biginteger/biginteger.js"></script>

<script type="text/javascript">

function timeToString(bigTime)
{
	timeString = bigTime.toString(16).toLowerCase();
	
	if (bigTime < 0) timeString = timeString.substring(1, timeString.length);
	
//	era = "<small>" + timeString.substring(timeString.length-51,timeString.length-48) + "</small> ";
//	age = "<small>" + timeString.substring(timeString.length-48,timeString.length-44) + "</small> ";
	
	year = date = minute = second = "";
	
	if (timeString.length >= 43) year = "<small>" + timeString.substring(timeString.length-44,timeString.length-42) + "</small> ";
	if (timeString.length >= 41) date = "<big>" + timeString.substring(timeString.length-42,timeString.length-40) + "</big>:";
	if (timeString.length >= 39) minute = "<big>" + timeString.substring(timeString.length-40,timeString.length-38) + "</big> ";
//	if (timeString.length >= 37) second = "<small>" + timeString.substring(timeString.length-38,timeString.length-36) + "</small>";
//	subsecond = ".<small>" + timeString.substring(timeString.length-36,timeString.length-35) + "</small>";

	if (bigTime < 0) year = "<small>-</small>" + year;
	
	result = year+date+minute+second;
	if ((result == "") || (result == "<small>-</small>")) result = "<big>0</big>";

	return result;
}

function fullTimeToString(bigTime)
{
	timeString = bigTime.toString(16).toLowerCase();

	era = "<small>" + timeString.substring(timeString.length-51,timeString.length-48) + "</small> ";
	age = "<small>" + timeString.substring(timeString.length-48,timeString.length-44) + "</small> ";
	year = "<small>" + timeString.substring(timeString.length-44,timeString.length-42) + "</small> ";
	date = "<big>" + timeString.substring(timeString.length-42,timeString.length-40) + "</big>:";
	minute = "<big>" + timeString.substring(timeString.length-40,timeString.length-38) + "</big> ";
	second = "<small>" + timeString.substring(timeString.length-38,timeString.length-36) + "</small>";
//	subsecond = ".<small>" + timeString.substring(timeString.length-36,timeString.length-35) + "</small>";

	return era+age+year+date+minute+second;
}

function bigTime(today)
{
	var b = BigInteger.parse(String(today.getTime()));
	b = b.add(new BigDecimal("2208988800000"));
	b = b.add(new BigDecimal("433600000000000000000"));
	b = b.multiply(new BigDecimal("1.8549227795646867220918E40"));

	return b;
}

function time(today)
{
	return '<font size="2" face="courier">' + timeToString(bigTime(today)) + '</font>';
}

function fulltime(today)
{
	return '<font size="10" face="courier">' + fullTimeToString(bigTime(today)) + ' <font size="-1">&middot10<sup>24</sup></font>' + '</font>';
}

function diff(today)
{
	return '<font size="2" face="courier">' + timeToString(bigTime(today).subtract(bigTime(new Date()))) + '</font>';
}

function event(name, dateBegin, dateEnd)
{	
	return "<tr><td>" + name + "</td><td>" + time(dateBegin) + "</td><td>" + time(dateEnd) + "</td><td style='text-align:right;'>" + diff(dateBegin) + "</td><td style='text-align:right;'>" + diff(dateEnd) + "</td></tr>";
}

function startTime(first)
{

	if (first) lastUpd = new Date();

	ftstr = fulltime(new Date());

	document.getElementById('curtime').innerHTML=ftstr+'<font size="2" face="courier"> (&plusmn a<font size="-1">&middot10<sup>30</sup></font>)';
	
	if (diff(lastUpd).length > 49) first = 1;
	
//	document.getElementById('curtime').innerHTML=diff(lastUpd).length;
	
	if ((ftstr.substring(122,124) == "00") || (ftstr.substring(122,124) == "80") || (first == 1)) {
	
		var eventTable = "";
		eventTable += "<tr><td width='250'>Event</td><td width='200'>Begin</td><td width='200'>End</td><td width='100' style='text-align:right;'>Till Begin</td><td width='200' style='text-align:right;'>Till End</td></tr>"
		
		eventTable += event('Sleep', new Date(2015,5,16,0,0,0), new Date(2015,5,16,9,0,0));
		eventTable += event('Wenzhen@Wolfram Tuesday', new Date(2015,5,16,9,0,0), new Date(2015,5,16,17,0,0));
		eventTable += event('Friday', new Date(2015,5,19,0,0,0), new Date(2015,5,20,0,0,0));
		eventTable += event('Saturday', new Date(2015,5,20,00,00,00), new Date(2015,5,21,00,00,00));
					
		document.getElementById('eventtable').innerHTML=eventTable;


		lastUpd = new Date();
	}

	t = setTimeout("startTime(0)",1166);
}

</script>
</head>

<body onload="startTime(1)">
<h1 style="text-align:center;"><div id="curtime"> </div></h1>

<font size="3"><table id="eventtable"> </table></font>

</body>
</html>


